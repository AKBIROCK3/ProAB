<?xml version="1.0" encoding="utf-8"?>
<appengine-web-app xmlns="http://appengine.google.com/ns/1.0">
  <application></application>
  <!--
    Using java8 along with url-stream-handler of native (default urlfetch) to overcome the 10mb limit
    https://cloud.google.com/appengine/docs/standard/#instance_classes
    https://cloud.google.com/appengine/docs/standard/java/config/appref#scaling_elements_basic_scaling
    https://cloud.google.com/appengine/docs/standard/java/quickstart
  -->
  <url-stream-handler>native</url-stream-handler>
  <runtime>java8</runtime>
  <version>49</version>

  <instance-class>F1</instance-class> <!-- F1: Basic for autoscaling. If B series (e.g. B2), then use below -->
  <!--<basic-scaling>
    <max-instances>11</max-instances>
    <idle-timeout>10m</idle-timeout>
  </basic-scaling>-->
  <!-- Devs:
    o. Compiler requires your own map key
    o. For Deployment, ADD GitHub, analytics from index.html
    analytics for gold
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-88836135-1', 'auto');
        ga('send', 'pageview');

    </script>
    o. YaClient.gwt.xml   - make sure languages are NOT commented out
    o. bump-up version number in app-engine
	o. build server. Is it localhost? AND NOT local or TEST
	o. gcs.bucket: goldappybuilder
    o. Companion version: (YaVersion & project.properties)

    o. blacklist=true and whitelist = false?
    o. Did you set the index chat server?
    o. on server3, nginx running on port 9990, but for same box use launcher.sh -p 9992 because loadbalancer is configured that wasy
    -->

  <!-- Configure serving/caching of GWT files -->
  <static-files>
    <include path="/blockly-*.js" expiration="365d">
      <http-header name="Content-Type" value="application/javascript; charset=UTF-8" />
    </include>
    <include path="/fonts/*" expiration="365d">
      <http-header name="Content-Type" value="font/ttf" />
    </include>
    <include path="/assets/*" />
    <include path="/companions/*" />
    <include path="/about/*" expiration="1d" />
    <include path="/static/**" expiration="1d" />
    <include path="/images/*" expiration="365d" />
    <include path="/Ya_tos_form.html" expiration="1d" />
    <include path="/favicon.ico" expiration="365d" />
    <include path="/gwt.css" expiration="1d" />
    <include path="/Ya.css" />
    <include path="/templates/**" expiration="1d" />
    <include path="/reference/**" expiration="1d" />
    <include path="/closure-library/closure/goog/base.js" expiration="1d" />
    <include path="/closure-library/closure/goog/css/dialog.css" expiration="1d" />
    <include path="/closure-library/closure/goog/css/hsvapalette.css" />
    <include path="/closure-library/closure/goog/deps.js" expiration="1d" />
    <include path="/leaflet/**" />
    <include path="/font-awesome/**" />
    <include path="/robots.txt" expiration="30d" />

    <!-- These are not cached on purpose -->
    <include path="/ode/**.nocache.*" expiration="0s" />
    <include path="/blocklyframe.html" expiration="0s" />
    <include path="/index.html" expiration="0s" />
    <include path="/android" expiration="0s" />

    <include path="/ode/**.cache.*" expiration="365d" />
    <exclude path="/ode/**.gwt.rpc" />

    <!-- don't serve the key file as a static file! -->
    <exclude path="/keystore/**" />

    <!-- don't serve the whitelist as a static file! -->
    <exclude path="/whitelist" />

  </static-files>

  <!-- Permit sessions for location authentication -->
  <!-- Not any more -->
  <sessions-enabled>false</sessions-enabled>

  <!-- Configuration and flags -->
  <threadsafe>true</threadsafe>

  <!-- Enable concurrency in the app engine server -->
  <system-properties>
    <!-- Don't need below because now we are using java8 and native (see above) -->
    <!--<property name="appengine.api.urlfetch.defaultDeadline" value="40"/> &lt;!&ndash; default 5 &ndash;&gt;-->
    <property name="java.util.logging.config.file" value="WEB-INF/logging.properties"/>

    <!-- note that the file: is necessary as part of the value for this property, because
         the log4j configuration is looking for a URL -->
    <property name="log4j.configuration" value="file:WEB-INF/log4j.properties"/>

    <!-- Set this to the IP Address or Host Name of the Rendezvous server.
         If left as the empty string, the default in YaVersion is used, which
         should be rendezvous.appinventor.mit.edu. Note: You can specify both
         a name and a port using a colon to separate them. For example you can
         use example.com:8888 to specify port 8888. Note: The rendezvous server
         is assumed to be a path "/rendezvous/" on the server. So specifying
         "example.com:8888" would mean the Rendezvous Server would be querired
         on http://example.com:8888/rendezvous/. -->

    <property name="use.rendezvousserver" value=""/>

    <!-- set to true if users should not be allowed to access the App
         Inventor server unless they are listed in the appengine/war/whitelist file -->
    <property name="use.whitelist" value="false"/>

    <!-- TODO 1: set bucket to empty string before checkin -->
    <!-- Name of storage bucket in Google Cloud Store -->
    <property name="gcs.bucket" value="goldappybuilder.appspot.com" />

    <!-- Whether or not to use GCS for storage -->
    <property name="use.gcs" value="true" />

    <!-- Name of gallery bucket in Google Cloud Store -->
    <property name="gallery.bucket" value="" />
    <!-- Whether or not to use the gallery -->
    <property name="use.gallery" value="false" />

    <!-- Gallery Admin Email -->
    <property name="gallery.admin.email" value="" />


    <!-- set to true if users need to accept a Terms of Service the first time
      they access App Inventor -->
    <property name="require.tos" value="true" />

    <!-- Flags that select authentication method
         set auth.usegoogle to true to use Google Accounts
         set auth.uselocal to permit local users (username is email address) and password.
         If both are set, the login page will have a link to permit people to use
         their Google Account.
         It is an error for neither to be set. Instead of a login page, visitors
         to the site will receive an error page.
     -->

    <property name="auth.usegoogle" value="true" />
    <property name="auth.uselocal" value="false" />

    <!-- Flags associated with localauth code -->
    <property name="localauth.mailserver" value="https://osiris.mit.edu/passmail/" />
    <property name="localauth.mailserver.password" value="changeme" />

    <!-- host[:port] to use for connecting to the build server -->
    <property name="build.server.host" value="63.142.252.156:9990" /> <!-- production Server 8 ubunto 16 with NGINX -->
    <!--<property name="build.server.host" value="localhost:9990" />-->

    <!-- host[:port] to tell build server the app host url to callback
         when deploy AppInventor on other GAE implementation such as
         AppScale.Keep it blank when deploy on GAE -->
    <property name="appengine.host" value="" />

    <!-- Interval is seconds between checking for a message of the day.
         Set set to 0 to disable checking for a MOTD.  If you do enable
         MOTD checking, make the interval long, because this check is
         resource expensive on App Engine -->
    <property name="motd.check.interval.secs" value="0" />

    <!-- Set this to false if we should not send the Git build version with build requests.
         This is useful when testing new servers where we don't want to require the
         buildserver to match -->
    <property name="build.send.git.version" value="true" />

    <!-- Session Management Variables. -->
    <!-- We define three variables here.
         All variables are defined in minutes
         session.idletimeout - defines how long until an idle session
                               is considered invalid.
         session.renew       - defines the time after which a new session
                               cookie is generated.
         session.noop        - defines the time interval between no-op calls
                               from Ode. 0 means never perform a no-op (the default)

         Note: If renew is > idletimeout, then people will get logged
         out involuntarily after idletimeout because their session
         will never renew and therefore is considered idle.
    -->

    <property name="session.idletimeout" value="120" />
    <property name="session.renew" value="30" />
    <property name="session.noop" value="0" />

    <!-- Set this to true to enable the use of Wifi connections from the blocks editor to
         the phone. The phone must have an up-to-date copy of the MIT AICompanion App to
         use this feature. -->
    <property name="wifi.enabled" value="true" />

    <!-- Firebase Secret for the shared datastore -->
    <property name="firebase.secret" value="" />
    <property name="firebase.url" value="" />

    <property name="library.url" value="http://appybuilder.com/explore/reference" />
    <property name="get_started.url" value="http://appybuilder.com/explore/get-started" />
    <property name="tutorials.url" value="http://appybuilder.com/explore/tutorials" />
    <property name="extensions.url" value="http://appinventor.mit.edu/extensions" />
    <property name="troubleshooting.url" value="http://appinventor.mit.edu/explore/ai2/support/troubleshooting" />
    <property name="forums.url" value="http://Community.AppyBuilder.com" />
    <property name="feedback.url" value="http://something.example.com" />
    <property name="release.notes.url" value=" https://help.appybuilder.com/release-notes.html" />
    <property name="tos.url" value="http://help.appybuilder.com/terms-of-service.html" />
    <property name="logo.url" value="http://appybuilder.com" />
    <property name="guide.url" value="http://help.appybuilder.com/" />
    <property name="community.url" value="http://community.appybuilder.com/" />
    <property name="reference.components.url" value="/reference/components/" />

    <!-- CloudDB secret keys -->
    <property name="clouddb.server" value="clouddb.appinventor.mit.edu"/>
    <property name="clouddb.uuid.secret" value="1bd8b82e-f253-11e7-ac14-9a214cf093ae"/>
    <property name="clouddb.secret" value="C7uFtZt84pgcFiQPbaebJPWoM8XrqJpH2TXK7JgLja9jCPRgYYRsG31xQQuMAesTy34rPzxUd778xnuQUKmZUTcjpyKr9qwGQvD4K1rPe6ddFyt6m9oQE" />

    <!--<property name="clouddb.uuid.secret" value="changeme!"/>-->

    <!--<property name="clouddb.server" value="104.251.212.194"/>-->
    <!--<property name="clouddb.uuid.secret" value="1bd8b82e-f253-11e7-ac14-9a214cf093ae"/>-->
    <!--<property name="clouddb.secret" value="mydifficultpassword" />-->

    <!--<property name="clouddb.server" value="104.251.212.194"/>-->
    <!--<property name="clouddb.uuid.secret" value="changeme!"/>-->
    <!--<property name="clouddb.secret" value="mydifficultpassword" />-->
  </system-properties>


</appengine-web-app>
